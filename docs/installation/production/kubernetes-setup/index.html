<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="alternate" type="application/rss+xml" href="/gsoc2021-sastixcms/blog/rss.xml" title="Sastix CMS Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/gsoc2021-sastixcms/blog/atom.xml" title="Sastix CMS Blog Atom Feed"><title data-react-helmet="true">Setup with Kubernetes | Sastix CMS</title><meta data-react-helmet="true" property="og:url" content="https://eellak.github.com/gsoc2021-sastixcms/docs/installation/production/kubernetes-setup"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Setup with Kubernetes | Sastix CMS"><meta data-react-helmet="true" name="description" content="The Kubernetes deployment offers the most advantages compared to the"><meta data-react-helmet="true" property="og:description" content="The Kubernetes deployment offers the most advantages compared to the"><link data-react-helmet="true" rel="shortcut icon" href="/gsoc2021-sastixcms/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://eellak.github.com/gsoc2021-sastixcms/docs/installation/production/kubernetes-setup"><link data-react-helmet="true" rel="alternate" href="https://eellak.github.com/gsoc2021-sastixcms/docs/installation/production/kubernetes-setup" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://eellak.github.com/gsoc2021-sastixcms/docs/installation/production/kubernetes-setup" hreflang="x-default"><link rel="stylesheet" href="/gsoc2021-sastixcms/assets/css/styles.6a05041f.css">
<link rel="preload" href="/gsoc2021-sastixcms/assets/js/runtime~main.8952098c.js" as="script">
<link rel="preload" href="/gsoc2021-sastixcms/assets/js/main.e8b35a91.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/gsoc2021-sastixcms/"><img src="/gsoc2021-sastixcms/img/sastix_logo.png" alt="Sastix CMS Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/gsoc2021-sastixcms/img/sastix_logo.png" alt="Sastix CMS Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Sastix CMS</b></a><a class="navbar__item navbar__link navbar__link--active" href="/gsoc2021-sastixcms/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/gsoc2021-sastixcms/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/eellak/gsoc2021-sastixcms" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/gsoc2021-sastixcms/docs/intro">Introduction</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Installation</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gsoc2021-sastixcms/docs/installation/installation-options">Overview</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Development</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Production</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gsoc2021-sastixcms/docs/installation/production/docker-compose-setup">Setup with docker-compose</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/gsoc2021-sastixcms/docs/installation/production/kubernetes-setup">Setup with Kubernetes</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Guides</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Benchmarking</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">GSoC</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">Setup with Kubernetes</h1></header><p>The Kubernetes deployment offers the most advantages compared to the
other local installations. It offers horizontal scaling and can
handle more traffic by assigning more resources. The autoscaling
feature offers incomparable value for the handling of traffic with
the appropriate resources.</p><p>Due to the multitude of options and the complexity of a Kubernetes
installation probably some deployments may vary. For example there
may be a need to change the persistent volumes depending on the
deployment&#x27;s requirements. These instructions are opinionated and
indicative and serve as a general guide. The administrator can tweak
the configuration to get optimal results.</p><p>The components that need to be deployed are:</p><ul><li><strong>The SQL database</strong>: MariaDB is used by default but it can be changed
to use some other MySQL option.</li><li><strong>The CMS server</strong>: The core Spring Boot application.</li><li><strong>The reverse proxy/Flutter application server</strong>: NGINX is the
preferred choice because of the throughput it can achieve, the
general acceptance but other options may be used, too. It is used as
a reverse proxy and as a server for the Flutter application.</li><li>(Optional but recommended) <strong>Keycloak</strong>: The Open Source Identity
and Access Management. This is the preferred solution if there is
no other OpenID server that can be used.</li><li>(Optional but recommended) <strong>Monitoring stack</strong>: The monitoring
stack is recommended for all deployments that should handle real
traffic. It is composed of the Prometheus-Grafana stack and can be
configured to monitor and alert the deployment.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-sql-database"></a>The SQL database<a class="hash-link" href="#the-sql-database" title="Direct link to heading">#</a></h2><p>The SQL database is used by the CMS server and optionally by the
Keycloak server. The suggested option is MariaDB. It is a robust
open-source SQL database and can offer highly available services
using a clustered deployment.</p><p>There is a multitude of common configurations to deploy a clustered
MariaDB. For example:</p><ul><li><a href="https://mariadb.org/fest2020/kubernetes/" target="_blank" rel="noopener noreferrer">MariaDB fest2020</a>.</li><li><a href="https://github.com/bitnami/bitnami-docker-mariadb-galera" target="_blank" rel="noopener noreferrer">Bitnami MariaDB Galera image</a>.</li></ul><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>A clustered SQL database is the best way to avoid running out of
available SQL connections while handling traffic from many users. It
can also be autoscaled with appropriate configuration.</p></div></div><p>The artifacts to deploy a simple MariaDB instance on Kubernetes are
provided in the <code>devops/deployment/mariadb/kubernetes</code> folder. They
can be deployed on a running Kubernetes cluster by getting to the
project&#x27;s root folder and executing:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">cd devops/deployment/mariadb/kubernetes</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f db-data-persistentvolumeclaim.yaml</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f db-deployment.yaml</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f db-service.yaml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-cms-server"></a>The CMS server<a class="hash-link" href="#the-cms-server" title="Direct link to heading">#</a></h2><p>The CMS server uses the aforementioned SQL database and provides the
core functionality. It can be autoscaled with ease and uses a
distributed caching to serve many requests with efficiency. An
indicative example of autoscaling the CMS server can be found in this
<a href="https://medium.com/@iskitsas/autoscale-a-java-cms-app-with-kubernetes-the-microk8s-approach-from-docker-to-kubernetes-7c021f7d8333" target="_blank" rel="noopener noreferrer">article</a>.</p><p>The artifacts for the deployment of the Sastix CMS server to
Kubernetes are in the <code>devops/deployment/sxcms/kubernetes</code> folder.
The basic CMS server can be deployed by getting to the project&#x27;s root
folder and running:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">cd devops/deployment/mariadb/kubernetes</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f sxcms-data-persistentvolumeclaim.yaml</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f sastix-cms-deployment.yaml</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f sastix-cms-service.yaml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>A file called <code>autoscaler-sample.yaml</code> is also provided with an
indicative example of the autoscaling features.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-reverse-proxyflutter-application-server"></a>The reverse proxy/Flutter application server<a class="hash-link" href="#the-reverse-proxyflutter-application-server" title="Direct link to heading">#</a></h2><p>The NGINX container can be deployed either standalone to handle
traffic or as a deployment behind an Ingress controller. A simple
Kubernetes yaml file is provided in the folder
<code>devops/deployment/nginx/kubernetes</code>. It can be deployed by building
the Docker image of sxcms-nginx, by getting to the root folder of the
project and executing:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">cd devops/deployment/nginx/kubernetes</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f nginx-deployment.yaml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-monitoring-stack"></a>The monitoring stack<a class="hash-link" href="#the-monitoring-stack" title="Direct link to heading">#</a></h2><p>The monitoring stack consists of a Grafana and a Prometheus
deployment. It can be deployed with numerous different configurations
depending on the needs of the project.</p><ul><li>Prometheus can be deployed by using the community helm chart:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo add prometheus-community https://prometheus-community.github.io/helm-charts</span></span><span class="token-line" style="color:#393A34"><span class="token plain">helm repo add stable https://kubernetes-charts.storage.googleapis.com/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">helm repo update</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>For Grafana, a simple deployment yaml is found at
<code>devops/deployment/grafana/kubernetes</code> and can be deployed by getting
to the project root folder and executing:<br></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">cd devops/deployment/grafana/kubernetes</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f grafana-deployment.yaml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This will bring up a single Grafana instance.<br></p><div class="admonition admonition-danger alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</h5></div><div class="admonition-content"><p>This Grafana instance is initialized with a volume of type emptyDir,
which means that when the pod gets killed the data from the Grafana
dashboards will be lost.</p></div></div><p>If the service is reached via an Ingress Controller, it may be
preferrable to use NGINX-Ingress because of its easy integration with
these monitoring tools
(<a href="https://kubernetes.github.io/ingress-nginx/user-guide/monitoring/" target="_blank" rel="noopener noreferrer">for example</a>).</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/eellak/gsoc2021-sastixcms/edit/master/website/docs/installation/production/kubernetes-setup.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/gsoc2021-sastixcms/docs/installation/production/docker-compose-setup"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Setup with docker-compose</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/gsoc2021-sastixcms/docs/guides/usage-of-sastix-cms"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Usage of Sastix CMS Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-sql-database" class="table-of-contents__link">The SQL database</a></li><li><a href="#the-cms-server" class="table-of-contents__link">The CMS server</a></li><li><a href="#the-reverse-proxyflutter-application-server" class="table-of-contents__link">The reverse proxy/Flutter application server</a></li><li><a href="#the-monitoring-stack" class="table-of-contents__link">The monitoring stack</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/gsoc2021-sastixcms/docs/intro">Documentation</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/gsoc2021-sastixcms/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/eellak/gsoc2021-sastixcms" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Sastix CMS. Built with Java, Dart and ðŸ’™.</div></div></div></footer></div>
<script src="/gsoc2021-sastixcms/assets/js/runtime~main.8952098c.js"></script>
<script src="/gsoc2021-sastixcms/assets/js/main.e8b35a91.js"></script>
</body>
</html>
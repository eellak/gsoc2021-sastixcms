"use strict";(self.webpackChunksastix_cms_docs=self.webpackChunksastix_cms_docs||[]).push([[772],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(n),m=r,h=u["".concat(l,".").concat(m)]||u[m]||d[m]||o;return n?a.createElement(h,i(i({ref:t},c),{},{components:n})):a.createElement(h,i({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var p=2;p<o;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},1937:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return p},toc:function(){return c},default:function(){return u}});var a=n(7462),r=n(3366),o=(n(7294),n(3905)),i=["components"],s={sidebar_position:3},l="Setup with Kubernetes",p={unversionedId:"installation/production/kubernetes-setup",id:"installation/production/kubernetes-setup",isDocsHomePage:!1,title:"Setup with Kubernetes",description:"The Kubernetes deployment offers the most advantages compared to the",source:"@site/docs/installation/production/kubernetes-setup.md",sourceDirName:"installation/production",slug:"/installation/production/kubernetes-setup",permalink:"/gsoc2021-sastixcms/docs/installation/production/kubernetes-setup",editUrl:"https://github.com/eellak/gsoc2021-sastixcms/edit/master/website/docs/installation/production/kubernetes-setup.md",version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"docsSidebar",previous:{title:"Setup with docker-compose",permalink:"/gsoc2021-sastixcms/docs/installation/production/docker-compose-setup"},next:{title:"Usage of Sastix CMS",permalink:"/gsoc2021-sastixcms/docs/guides/usage-of-sastix-cms"}},c=[{value:"The SQL database",id:"the-sql-database",children:[]},{value:"The CMS server",id:"the-cms-server",children:[]},{value:"The reverse proxy/Flutter application server",id:"the-reverse-proxyflutter-application-server",children:[]},{value:"The monitoring stack",id:"the-monitoring-stack",children:[]}],d={toc:c};function u(e){var t=e.components,n=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"setup-with-kubernetes"},"Setup with Kubernetes"),(0,o.kt)("p",null,"The Kubernetes deployment offers the most advantages compared to the\nother local installations. It offers horizontal scaling and can\nhandle more traffic by assigning more resources. The autoscaling\nfeature offers incomparable value for the handling of traffic with\nthe appropriate resources."),(0,o.kt)("p",null,"Due to the multitude of options and the complexity of a Kubernetes\ninstallation probably some deployments may vary. For example there\nmay be a need to change the persistent volumes depending on the\ndeployment's requirements. These instructions are opinionated and\nindicative and serve as a general guide. The administrator can tweak\nthe configuration to get optimal results."),(0,o.kt)("p",null,"The components that need to be deployed are:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"The SQL database"),": MariaDB is used by default but it can be changed\nto use some other MySQL option."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"The CMS server"),": The core Spring Boot application."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"The reverse proxy/Flutter application server"),": NGINX is the\npreferred choice because of the throughput it can achieve, the\ngeneral acceptance but other options may be used, too. It is used as\na reverse proxy and as a server for the Flutter application."),(0,o.kt)("li",{parentName:"ul"},"(Optional but recommended) ",(0,o.kt)("strong",{parentName:"li"},"Keycloak"),": The Open Source Identity\nand Access Management. This is the preferred solution if there is\nno other OpenID server that can be used."),(0,o.kt)("li",{parentName:"ul"},"(Optional but recommended) ",(0,o.kt)("strong",{parentName:"li"},"Monitoring stack"),": The monitoring\nstack is recommended for all deployments that should handle real\ntraffic. It is composed of the Prometheus-Grafana stack and can be\nconfigured to monitor and alert the deployment.")),(0,o.kt)("h2",{id:"the-sql-database"},"The SQL database"),(0,o.kt)("p",null,"The SQL database is used by the CMS server and optionally by the\nKeycloak server. The suggested option is MariaDB. It is a robust\nopen-source SQL database and can offer highly available services\nusing a clustered deployment."),(0,o.kt)("p",null,"There is a multitude of common configurations to deploy a clustered\nMariaDB. For example:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://mariadb.org/fest2020/kubernetes/"},"MariaDB fest2020"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/bitnami/bitnami-docker-mariadb-galera"},"Bitnami MariaDB Galera image"),".")),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"A clustered SQL database is the best way to avoid running out of\navailable SQL connections while handling traffic from many users. It\ncan also be autoscaled with appropriate configuration."))),(0,o.kt)("p",null,"The artifacts to deploy a simple MariaDB instance on Kubernetes are\nprovided in the ",(0,o.kt)("inlineCode",{parentName:"p"},"devops/deployment/mariadb/kubernetes")," folder. They\ncan be deployed on a running Kubernetes cluster by getting to the\nproject's root folder and executing:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"cd devops/deployment/mariadb/kubernetes\nkubectl apply -f db-data-persistentvolumeclaim.yaml\nkubectl apply -f db-deployment.yaml\nkubectl apply -f db-service.yaml\n")),(0,o.kt)("h2",{id:"the-cms-server"},"The CMS server"),(0,o.kt)("p",null,"The CMS server uses the aforementioned SQL database and provides the\ncore functionality. It can be autoscaled with ease and uses a\ndistributed caching to serve many requests with efficiency. An\nindicative example of autoscaling the CMS server can be found in this\n",(0,o.kt)("a",{parentName:"p",href:"https://medium.com/@iskitsas/autoscale-a-java-cms-app-with-kubernetes-the-microk8s-approach-from-docker-to-kubernetes-7c021f7d8333"},"article"),"."),(0,o.kt)("p",null,"The artifacts for the deployment of the Sastix CMS server to\nKubernetes are in the ",(0,o.kt)("inlineCode",{parentName:"p"},"devops/deployment/sxcms/kubernetes")," folder.\nThe basic CMS server can be deployed by getting to the project's root\nfolder and running:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"cd devops/deployment/mariadb/kubernetes\nkubectl apply -f sxcms-data-persistentvolumeclaim.yaml\nkubectl apply -f sastix-cms-deployment.yaml\nkubectl apply -f sastix-cms-service.yaml\n")),(0,o.kt)("p",null,"A file called ",(0,o.kt)("inlineCode",{parentName:"p"},"autoscaler-sample.yaml")," is also provided with an\nindicative example of the autoscaling features."),(0,o.kt)("h2",{id:"the-reverse-proxyflutter-application-server"},"The reverse proxy/Flutter application server"),(0,o.kt)("p",null,"The NGINX container can be deployed either standalone to handle\ntraffic or as a deployment behind an Ingress controller. A simple\nKubernetes yaml file is provided in the folder\n",(0,o.kt)("inlineCode",{parentName:"p"},"devops/deployment/nginx/kubernetes"),". It can be deployed by building\nthe Docker image of sxcms-nginx, by getting to the root folder of the\nproject and executing:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"cd devops/deployment/nginx/kubernetes\nkubectl apply -f nginx-deployment.yaml\n")),(0,o.kt)("h2",{id:"the-monitoring-stack"},"The monitoring stack"),(0,o.kt)("p",null,"The monitoring stack consists of a Grafana and a Prometheus\ndeployment. It can be deployed with numerous different configurations\ndepending on the needs of the project."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Prometheus can be deployed by using the community helm chart:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"helm repo add prometheus-community https://prometheus-community.github.io/helm-charts\nhelm repo add stable https://kubernetes-charts.storage.googleapis.com/\nhelm repo update\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"For Grafana, a simple deployment yaml is found at\n",(0,o.kt)("inlineCode",{parentName:"li"},"devops/deployment/grafana/kubernetes")," and can be deployed by getting\nto the project root folder and executing:",(0,o.kt)("br",null))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"cd devops/deployment/grafana/kubernetes\nkubectl apply -f grafana-deployment.yaml\n")),(0,o.kt)("p",null,"This will bring up a single Grafana instance.",(0,o.kt)("br",null)),(0,o.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"danger")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"This Grafana instance is initialized with a volume of type emptyDir,\nwhich means that when the pod gets killed the data from the Grafana\ndashboards will be lost."))),(0,o.kt)("p",null,"If the service is reached via an Ingress Controller, it may be\npreferrable to use NGINX-Ingress because of its easy integration with\nthese monitoring tools\n(",(0,o.kt)("a",{parentName:"p",href:"https://kubernetes.github.io/ingress-nginx/user-guide/monitoring/"},"for example"),")."))}u.isMDXComponent=!0}}]);